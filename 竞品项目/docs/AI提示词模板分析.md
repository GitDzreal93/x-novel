# 🤖 AI 提示词模板深度分析

## 架构类提示词详解

### 1. 核心种子提示词 (coreSeed)

#### 提示词结构
```
作为专业作家，请用"雪花写作法"第一步构建故事核心
主题：{topic}
类型：{genre}
篇幅：约{numberOfChapters}章（每章{wordNumber}字）

请根据【{genre}】类型的特点，用单句公式概括故事本质
```

#### 类型适配公式

**悬疑/惊悚类公式**
```
"当[主角]遭遇[核心事件]，必须[关键行动]，否则[灾难后果]；
与此同时，[隐藏的更大危机]正在发酵。"
```

**言情/温馨类公式**
```
"当[主角]在[背景环境]中遇见[另一角色]，两人因[契机]产生羁绊，
在[成长/治愈过程]中收获[情感结局]。"
```

**玄幻/仙侠类公式**
```
"当[主角]获得[机缘]，踏上[修炼之路]，面对[挑战]，
逐步成长为[最终成就]。"
```

**都市/现实类公式**
```
"当[主角]面临[现实困境]，通过[努力方式]，实现[人生目标]，
同时收获[情感/成长]。"
```

#### 约束条件
1. 严格遵循类型特征和情感基调
2. 体现人物核心驱动力
3. 暗示世界观或故事背景的关键特点
4. 字数要求：25-100 字
5. 仅返回文本，不要解释

---

### 2. 角色动力学生成 (characterDynamics)

#### 输出结构
```yaml
角色名:
  特征:
    - 背景：...
    - 外貌：...
    - 性别：...
    - 年龄：...
    - 职业：...
    - 角色独特之处：...
    - 成长空间：...

  核心驱动力三角:
    - 表面追求（物质目标）：...
    - 深层渴望（情感需求）：...
    - 灵魂需求（哲学层面）：...

  角色弧线设计:
    - 初始状态：...
    - 触发事件：...
    - 内心转变：...
    - 成长节点：...
    - 最终状态：...

  角色关系网:
    - 与[角色A]的关系：...
      - 互动模式：...
      - 羁绊/张力来源：...
      - 情感连接点：...
      - 需要跨越的障碍：...
```

#### 关键设计理念
1. **3-6 个核心角色**: 主角 + 重要配角 + 反派
2. **驱动力三角**: 表层 → 深层 → 哲学，层层递进
3. **弧光设计**: 角色需要成长和变化的空间
4. **关系网络**: 每个角色至少与 2-3 个其他角色有关系

---

### 3. 角色状态文档 (characterState)

#### 结构化输出格式
```
张三：
├──物品:
│  ├──青衫：一件破损的青色长袍，带有暗红色的污渍
│  └──寒铁长剑：一柄断裂的铁剑，剑身上刻有古老的符文
├──能力
│  ├──技能1：强大的精神感知能力：能够察觉到周围人的心中活动
│  └──技能2：无形攻击：能够释放一种无法被视觉捕捉的精神攻击
├──状态
│  ├──身体状态: 身材挺拔，穿着华丽的铠甲，面色冷峻
│  └──心理状态: 目前的心态比较平静，但内心隐藏着对柳溪镇未来掌控的野心和不安
├──主要角色间关系网
│  ├──李四：张三从小就与她有关联，对她的成长一直保持关注
│  └──王二：两人之间有着复杂的过去，最近因一场冲突而让对方感到威胁
└──触发或加深的事件
   ├──村庄内突然出现不明符号：这个不明符号似乎在暗示柳溪镇即将发生重大事件
   └──李四被刺穿皮肤：这次事件让两人意识到对方的强大实力，促使他们迅速离开队伍
```

#### 更新机制
- 每章定稿时自动更新
- 通过 AI 分析章节内容
- 提取新增物品、能力变化、状态变化、关系变化、新事件

---

### 4. 世界观构建 (worldBuilding)

#### 三维交织法

**物理维度**
- 空间结构：地理环境、主要场景
- 时间背景：故事发生的时代、时间跨度
- 规则体系：该世界的基本运行法则

**社会维度**
- 社会结构：人物所处的社会环境
- 文化氛围：风俗、习惯、价值观
- 生活方式：日常生活的细节设定

**情感维度**
- 贯穿全书的核心意象：反复出现的场景、物品、象征
- 环境氛围与故事情感的呼应关系
- 场景设计如何强化类型的情感体验

#### 动态元素要求
每个维度至少包含 3 个可与角色决策产生互动的动态元素

---

### 5. 情节架构 (plotArchitecture)

#### 三幕式结构

**第一幕（开端）**
- 日常状态展示（3 处场景铺垫）
- 引出故事：主线、感情线、副线的开端
- 契机事件：推动故事发展的触发点
- 初步反应：主角面对变化的第一反应

**第二幕（发展）**
- 剧情深入：主线 + 感情线的交织发展
- 挑战与成长：角色面临的困难和内心变化
- 情感升温/矛盾激化：关系发展的关键节点
- 重要转折：改变故事走向的关键时刻

**第三幕（高潮与结局）**
- 核心冲突爆发：故事的高潮部分
- 角色抉择：主角做出重要决定
- 情感/事件收尾：符合类型的结局处理

#### 伏笔设计
每个阶段需包含 3 个关键节点及其伏笔设计

---

## 章节类提示词详解

### 6. 章节大纲生成 (blueprint)

#### 输出格式
```
第1章 - 异象初现
本章定位：事件引入
核心作用：推进剧情
情感强度：渐进
伏笔操作：埋设(神秘符号)→强化(主角感知力)
情节张力：★☆☆☆☆
本章简述：柳溪镇突然出现神秘符号，张三察觉到异常的气息，与李四商议对策

第2章 - 暗流涌动
本章定位：角色发展
核心作用：转折
情感强度：高潮
伏笔操作：强化(主角-李四关系)→埋设(王二身份疑点)
情节张力：★★★★☆
本章简述：李四在调查中受伤，王二展现出可疑行为，张三开始怀疑...
```

#### 节奏设计原则
1. **章节集群划分**: 每 3-5 章构成一个情节单元
2. **情感节奏**: 单元之间张弛有度
3. **关键转折**: 预留铺垫
4. **每章字数控制在 100 字以内**
5. **情节设计符合类型风格和情感基调**

---

### 7. 第一章草稿生成 (firstDraft)

#### 输入参数
```
章节信息:
  - 章节号
  - 章节标题
  - 章节定位
  - 核心作用
  - 悬念密度
  - 伏笔操作
  - 认知颠覆
  - 本章简述

可用元素:
  - 核心人物
  - 关键道具
  - 空间坐标
  - 时间压力

参考文档:
  - 小说设定（核心种子 + 角色体系 + 世界观 + 情节架构）
  - 用户指导
```

#### 场景设计要求

**1. 对话场景**
- 体现人物性格和关系
- 推动剧情或情感发展

**2. 动作/互动场景**
- 环境交互细节（感官描写）
- 节奏控制（根据情节需要调整）
- 通过行动展现人物特质

**3. 心理/情感场景**
- 人物内心活动描写
- 情感变化的细腻刻画
- 符合类型的情感基调

**4. 环境场景**
- 场景氛围营造
- 环境与人物心情的呼应
- 符合类型的整体风格

#### 格式要求
- 仅返回章节正文文本
- 不使用分章节小标题
- 不要使用 markdown 格式

---

### 8. 后续章节草稿生成 (nextDraft)

#### 上下文参数
```
参考文档:
└── 前文摘要：{globalSummary}
└── 前章结尾段：{previousChapterExcerpt}
└── 用户指导：{userGuidance}
└── 角色状态：{characterState}
└── 当前章节摘要：{shortSummary}

当前章节信息:
  - 章节号、标题
  - 章节定位、核心作用
  - 悬念密度、伏笔设计
  - 转折程度、章节简述
  - 字数要求
  - 核心人物、关键道具
  - 场景地点、时间压力

下一章节目录:
  - 章节号、标题
  - 章节定位、核心作用
  - 悬念密度、伏笔设计
  - 转折程度、章节简述
```

#### 连贯性保证
1. 严格遵循用户指导
2. 符合当前章节摘要
3. 符合当前章节信息
4. 确保无逻辑漏洞
5. 与前文摘要、前章结尾段衔接流畅
6. 与下一章目录保证上下文完整性

---

### 9. 章节扩写 (enrich)

#### 扩写策略
- 保持剧情连贯性
- 增加环境描写和心理描写
- 丰富对话和场景细节
- 接近目标字数

---

## Compass 提示词详解

### 10. 基线图谱提取 (extractGraph)

#### 实体类型定义
```javascript
// character（角色）
{
  id: "char_zhangsan",
  label: "张三",
  type: "character",
  importance: 8,        // 1-10，主角 9-10
  faction: "正道门派" | null,
  status: "active",
  bio: "一句话简介",
  traits: ["特征1", "特征2"],
  firstAppearance: 0
}

// faction（阵营/组织）
{
  id: "fac_zhengdao",
  label: "正道联盟",
  type: "faction",
  ...
}

// location（地点）
{
  id: "loc_liuxi",
  label: "柳溪镇",
  type: "location",
  ...
}

// item（物品）
{
  id: "item_hanjian",
  label: "寒铁剑",
  type: "item",
  ...
}
```

#### 关系类型定义
```javascript
{
  id: "edge_zhangsan_lisi_1",
  source: "char_zhangsan",
  target: "char_lisi",
  relationType: "hostile" | "romantic" | "alliance" | "neutral" | "family" | "mentor",
  label: "关系简述",
  strength: 7,         // 1-10
  description: "详细关系描述",
  events: ["关键事件1", "关键事件2"]
}
```

#### 命名规则
- 角色前缀：`char_`
- 阵营前缀：`fac_`
- 地点前缀：`loc_`
- 物品前缀：`item_`
- ID 使用拼音简写

---

### 11. 章节增量提取 (extractChapterDelta)

#### 输出格式
```json
{
  "newNodes": [
    { "id": "char_xxx", "label": "新角色", "type": "character", "importance": 5, ... }
  ],
  "updatedNodes": [
    { "id": "已有节点id", "changes": { "status": "deceased", "importance": 7 } }
  ],
  "removedNodeIds": ["char_yyy"],
  "newEdges": [...],
  "updatedEdges": [...],
  "removedEdgeIds": [...]
}
```

#### 状态变化规则
- 角色死亡：`status` 改为 `"deceased"`
- 角色离场：`status` 改为 `"offline"`
- 关系转变：更新 `relationType` 和 `events`

---

### 12. 逻辑审计 (auditGraph)

#### 检测的问题类型

**1. dead_reappear（角色死而复生）**
```
角色在第 N 章死亡，但在后续章节又出现互动
```

**2. missing_setup（关系铺垫缺失）**
```
两个角色突然产生关系，但之前没有任何铺垫
```

**3. faction_conflict（阵营矛盾）**
```
角色的阵营归属与其关系网络矛盾
```

**4. orphan_thread（剧情线断裂）**
```
某条关系线在中途断裂，没有后续发展也没有交代
```

**5. weight_imbalance（戏份失衡）**
```
配角戏份权重超过主角，可能抢夺主线
```

#### 严重程度分级
- `error`: 严重逻辑错误
- `warning`: 潜在问题
- `info`: 建议优化

---

### 13. 单章关系提取 (extractChapterGraph)

#### 与基线图谱的区别
- 仅提取本章中实际出场或被提及的角色
- importance 基于本章戏份
- strength 基于本章互动密切度
- 不包含 firstAppearance

---

## 提示词工程最佳实践

### 1. 类型感知
所有提示词都包含 `根据【${genre}】类型特点` 的指导

### 2. 模板化
为不同类型提供不同的公式模板，确保生成内容符合类型特征

### 3. 约束明确
- 字数要求
- 格式要求（不要 markdown）
- 内容要求（不要解释）

### 4. 上下文丰富
章节生成时传入大量上下文：前文摘要、前章结尾、角色状态、下一章目录

### 5. JSON 严格输出
图谱相关提示词多次强调仅输出 JSON，不要代码块标记

### 6. 增量设计
章节快照采用增量设计（delta），减少上下文长度

---

## 复刻提示词要点

### 必须保留
1. 所有提示词的类型感知逻辑
2. 角色驱动力的三角结构
3. 世界观的三维交织法
4. 章节大纲的悬念节奏设计
5. 关系图谱的实体分类和命名规则

### 可以优化
1. 增加更多类型的公式模板
2. 优化提示词的长度（减少 token 消耗）
3. 增加示例（few-shot learning）
4. 调整约束条件以获得更好的输出质量

### 创新方向
1. 支持用户自定义提示词模板
2. 提示词 A/B 测试
3. 多模型提示词适配
4. 提示词版本管理

---

**文档生成时间**: 2026-02-27
